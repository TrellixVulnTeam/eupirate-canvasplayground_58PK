{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar _a;\n\nimport * as React from 'react';\nimport elementClosestPolyfill from 'element-closest';\nexport var InputType;\n\n(function (InputType) {\n  InputType[\"Initial\"] = \"initial\";\n  InputType[\"Keyboard\"] = \"keyboard\";\n  InputType[\"Mouse\"] = \"mouse\";\n  InputType[\"Pointer\"] = \"pointer\";\n  InputType[\"Touch\"] = \"touch\";\n})(InputType || (InputType = {}));\n\nexport var InputEventType;\n\n(function (InputEventType) {\n  InputEventType[\"KeyDown\"] = \"keydown\";\n  InputEventType[\"KeyUp\"] = \"keyup\";\n  InputEventType[\"MouseDown\"] = \"mousedown\";\n  InputEventType[\"MouseMove\"] = \"mousemove\";\n  InputEventType[\"Wheel\"] = \"wheel\";\n  InputEventType[\"MouseWheel\"] = \"mousewheel\";\n  InputEventType[\"PointerDown\"] = \"pointerdown\";\n  InputEventType[\"PointerMove\"] = \"pointermove\";\n  InputEventType[\"TouchStart\"] = \"touchstart\";\n})(InputEventType || (InputEventType = {}));\n\nvar formInputs = ['input', 'select', 'textarea'];\nvar ignoreKeys = ['Shift', 'Control', 'Alt', 'Meta', 'OS'];\nexport var inputEventMap = (_a = {}, _a[InputEventType.KeyDown] = InputType.Keyboard, _a[InputEventType.KeyUp] = InputType.Keyboard, _a[InputEventType.MouseDown] = InputType.Mouse, _a[InputEventType.MouseMove] = InputType.Mouse, _a[InputEventType.Wheel] = InputType.Mouse, _a[InputEventType.MouseWheel] = InputType.Mouse, _a[InputEventType.PointerDown] = InputType.Pointer, _a[InputEventType.PointerMove] = InputType.Pointer, _a[InputEventType.TouchStart] = InputType.Touch, _a);\nvar pointerMap = {\n  2: InputType.Touch,\n  3: InputType.Touch,\n  4: InputType.Mouse\n};\n\nvar getPointerType = function (event) {\n  if (typeof event.pointerType === 'number') {\n    return pointerMap[event.pointerType];\n  } else if (event.pointerType === 'mouse') {\n    return InputType.Mouse;\n  } else {\n    return InputType.Touch;\n  }\n};\n\nvar detectWheel = function () {\n  var wheelType;\n\n  if ('onwheel' in document.createElement('div')) {\n    wheelType = InputEventType.Wheel;\n  } else {\n    wheelType = InputEventType.MouseWheel;\n  }\n\n  return wheelType;\n};\n\nvar supportsPassive = function () {\n  var supportsPassive;\n\n  try {\n    var opts = Object.defineProperty({}, 'passive', {\n      get: function () {\n        supportsPassive = true;\n      }\n    });\n\n    var stub = function () {\n      return;\n    };\n\n    window.addEventListener('test', stub, opts);\n    window.removeEventListener('test', stub, opts);\n  } catch (e) {\n    console.warn('Browser does not support passive event listeners');\n  }\n\n  return supportsPassive || false;\n};\n\nvar InputProvider = function (_super) {\n  __extends(InputProvider, _super);\n\n  function InputProvider(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.isBuffering = false;\n    _this.isScrolling = false;\n    _this.mousePosX = null;\n    _this.mousePosY = null;\n    _this.deferInputTracking = false;\n    _this.provideIntent = _this.props.provideIntent;\n    var storedInput, storedIntent;\n\n    try {\n      storedInput = window.sessionStorage.getItem('what-input');\n      storedIntent = window.sessionStorage.getItem('what-intent');\n    } catch (e) {\n      console.warn('Failed to retrieve input status from session storage' + e);\n    }\n\n    _this.currentInput = storedInput || InputType.Initial;\n    _this.currentIntent = storedIntent || InputType.Initial;\n    _this.setInput = _this.setInput.bind(_this);\n    _this.setIntent = _this.setIntent.bind(_this);\n    _this.eventBuffer = _this.eventBuffer.bind(_this);\n    return _this;\n  }\n\n  InputProvider.prototype.getContainer = function (container) {\n    if (!container) {\n      return document.body;\n    }\n\n    if ('current' in container) {\n      if (container.current === null) {\n        console.warn('Your ref object can not be null, therefore, falling back to document.body');\n        return document.body;\n      } else {\n        return container.current;\n      }\n    }\n\n    return container;\n  };\n\n  InputProvider.prototype.componentDidMount = function () {\n    elementClosestPolyfill(window);\n    this.supportsPassive = supportsPassive();\n\n    if (this.getContainer(this.props.container).closest('[data-whatinput]')) {\n      this.deferInputTracking = true;\n      return;\n    }\n\n    this.updateAttributes();\n    this.enableListeners(true);\n  };\n\n  InputProvider.prototype.updateAttributes = function () {\n    var intent = this.provideIntent ? this.currentIntent : null;\n    this.getContainer(this.props.container).setAttribute('data-whatinput', this.currentInput);\n\n    if (intent) {\n      this.getContainer(this.props.container).setAttribute('data-whatintent', intent);\n    }\n\n    try {\n      window.sessionStorage.setItem('what-input', this.currentInput);\n      window.sessionStorage.setItem('what-intent', this.currentIntent);\n    } catch (e) {\n      console.warn('Failed to set input status in session storage' + e);\n    }\n  };\n\n  InputProvider.prototype.componentWillUnmount = function () {\n    if (this.deferInputTracking) {\n      return;\n    }\n\n    this.getContainer(this.props.container).removeAttribute('data-whatinput');\n    this.getContainer(this.props.container).removeAttribute('data-whatintent');\n    window.clearTimeout(this.eventTimer);\n    this.enableListeners(false);\n  };\n\n  InputProvider.prototype.enableListeners = function (enable) {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    var options = this.supportsPassive ? {\n      passive: true\n    } : false;\n    var fn = enable ? window.addEventListener : window.removeEventListener;\n\n    if (window.PointerEvent) {\n      fn('pointerdown', this.setInput);\n    } else {\n      fn('mousedown', this.setInput);\n\n      if ('ontouchstart' in window) {\n        fn('touchstart', this.eventBuffer, options);\n        fn('touchend', this.setInput);\n      }\n    }\n\n    if (this.provideIntent) {\n      if (window.PointerEvent) {\n        fn('pointermove', this.setIntent);\n      } else {\n        fn('mousemove', this.setIntent);\n      }\n\n      fn(detectWheel(), this.setIntent, options);\n    }\n\n    fn('keydown', this.eventBuffer);\n    fn('keyup', this.eventBuffer);\n  };\n\n  InputProvider.prototype.setInput = function (event) {\n    if (this.isBuffering) {\n      return;\n    }\n\n    var eventKey = 'key' in event ? event.key : undefined;\n    var eventType = event.type;\n    var value = inputEventMap[eventType];\n\n    if (value === InputType.Pointer) {\n      value = getPointerType(event);\n    }\n\n    var ignoreMatch = eventKey ? ignoreKeys.indexOf(eventKey) === -1 : undefined;\n    var shouldUpdate = value === InputType.Keyboard && eventKey && ignoreMatch || value === InputType.Mouse || value === InputType.Touch;\n\n    if (this.currentInput !== value && shouldUpdate) {\n      this.currentInput = value;\n      this.updateAttributes();\n    }\n\n    if (this.currentIntent !== value && shouldUpdate && this.provideIntent) {\n      var activeElem = document.activeElement;\n      var notFormInput = activeElem && activeElem.nodeName && formInputs.indexOf(activeElem.nodeName.toLowerCase()) === -1;\n\n      if (notFormInput) {\n        this.currentIntent = value;\n        this.updateAttributes();\n      }\n    }\n  };\n\n  InputProvider.prototype.setIntent = function (event) {\n    this.detectScrolling(event);\n\n    if (!this.isBuffering && !this.isScrolling) {\n      var eventType = event.type;\n      var value = inputEventMap[eventType];\n\n      if (value === InputType.Pointer) {\n        value = getPointerType(event);\n      }\n\n      this.currentIntent = value;\n      this.updateAttributes();\n    }\n  };\n\n  InputProvider.prototype.eventBuffer = function (event) {\n    var _this = this;\n\n    this.setInput(event);\n    window.clearTimeout(this.eventTimer);\n    this.isBuffering = true;\n    this.eventTimer = window.setTimeout(function () {\n      _this.isBuffering = false;\n    }, 100);\n  };\n\n  InputProvider.prototype.detectScrolling = function (event) {\n    if (this.mousePosX !== event.screenX || this.mousePosY !== event.screenY) {\n      this.isScrolling = false;\n      this.mousePosX = event.screenX;\n      this.mousePosY = event.screenY;\n    } else {\n      this.isScrolling = true;\n    }\n  };\n\n  InputProvider.prototype.render = function () {\n    return this.props.children || null;\n  };\n\n  return InputProvider;\n}(React.Component);\n\nexport { InputProvider };\nexport default InputProvider;","map":{"version":3,"sources":["/Users/janet.xuishi/node_modules/@workday/canvas-kit-react/dist/es6/common/lib/InputProvider.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","_a","React","elementClosestPolyfill","InputType","InputEventType","formInputs","ignoreKeys","inputEventMap","KeyDown","Keyboard","KeyUp","MouseDown","Mouse","MouseMove","Wheel","MouseWheel","PointerDown","Pointer","PointerMove","TouchStart","Touch","pointerMap","getPointerType","event","pointerType","detectWheel","wheelType","document","createElement","supportsPassive","opts","defineProperty","get","stub","window","addEventListener","removeEventListener","e","console","warn","InputProvider","_super","props","_this","call","isBuffering","isScrolling","mousePosX","mousePosY","deferInputTracking","provideIntent","storedInput","storedIntent","sessionStorage","getItem","currentInput","Initial","currentIntent","setInput","bind","setIntent","eventBuffer","getContainer","container","body","current","componentDidMount","closest","updateAttributes","enableListeners","intent","setAttribute","setItem","componentWillUnmount","removeAttribute","clearTimeout","eventTimer","enable","options","passive","fn","PointerEvent","eventKey","key","undefined","eventType","type","value","ignoreMatch","indexOf","shouldUpdate","activeElem","activeElement","notFormInput","nodeName","toLowerCase","detectScrolling","setTimeout","screenX","screenY","render","children","Component"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar _a;\nimport * as React from 'react';\nimport elementClosestPolyfill from 'element-closest';\nexport var InputType;\n(function (InputType) {\n    InputType[\"Initial\"] = \"initial\";\n    InputType[\"Keyboard\"] = \"keyboard\";\n    InputType[\"Mouse\"] = \"mouse\";\n    InputType[\"Pointer\"] = \"pointer\";\n    InputType[\"Touch\"] = \"touch\";\n})(InputType || (InputType = {}));\nexport var InputEventType;\n(function (InputEventType) {\n    InputEventType[\"KeyDown\"] = \"keydown\";\n    InputEventType[\"KeyUp\"] = \"keyup\";\n    InputEventType[\"MouseDown\"] = \"mousedown\";\n    InputEventType[\"MouseMove\"] = \"mousemove\";\n    InputEventType[\"Wheel\"] = \"wheel\";\n    InputEventType[\"MouseWheel\"] = \"mousewheel\";\n    InputEventType[\"PointerDown\"] = \"pointerdown\";\n    InputEventType[\"PointerMove\"] = \"pointermove\";\n    InputEventType[\"TouchStart\"] = \"touchstart\";\n})(InputEventType || (InputEventType = {}));\nvar formInputs = ['input', 'select', 'textarea'];\nvar ignoreKeys = ['Shift', 'Control', 'Alt', 'Meta', 'OS'];\nexport var inputEventMap = (_a = {},\n    _a[InputEventType.KeyDown] = InputType.Keyboard,\n    _a[InputEventType.KeyUp] = InputType.Keyboard,\n    _a[InputEventType.MouseDown] = InputType.Mouse,\n    _a[InputEventType.MouseMove] = InputType.Mouse,\n    _a[InputEventType.Wheel] = InputType.Mouse,\n    _a[InputEventType.MouseWheel] = InputType.Mouse,\n    _a[InputEventType.PointerDown] = InputType.Pointer,\n    _a[InputEventType.PointerMove] = InputType.Pointer,\n    _a[InputEventType.TouchStart] = InputType.Touch,\n    _a);\nvar pointerMap = {\n    2: InputType.Touch,\n    3: InputType.Touch,\n    4: InputType.Mouse,\n};\nvar getPointerType = function (event) {\n    if (typeof event.pointerType === 'number') {\n        return pointerMap[event.pointerType];\n    }\n    else if (event.pointerType === 'mouse') {\n        return InputType.Mouse;\n    }\n    else {\n        return InputType.Touch;\n    }\n};\nvar detectWheel = function () {\n    var wheelType;\n    if ('onwheel' in document.createElement('div')) {\n        wheelType = InputEventType.Wheel;\n    }\n    else {\n        wheelType = InputEventType.MouseWheel;\n    }\n    return wheelType;\n};\nvar supportsPassive = function () {\n    var supportsPassive;\n    try {\n        var opts = Object.defineProperty({}, 'passive', {\n            get: function () {\n                supportsPassive = true;\n            },\n        });\n        var stub = function () {\n            return;\n        };\n        window.addEventListener('test', stub, opts);\n        window.removeEventListener('test', stub, opts);\n    }\n    catch (e) {\n        console.warn('Browser does not support passive event listeners');\n    }\n    return supportsPassive || false;\n};\nvar InputProvider = (function (_super) {\n    __extends(InputProvider, _super);\n    function InputProvider(props) {\n        var _this = _super.call(this, props) || this;\n        _this.isBuffering = false;\n        _this.isScrolling = false;\n        _this.mousePosX = null;\n        _this.mousePosY = null;\n        _this.deferInputTracking = false;\n        _this.provideIntent = _this.props.provideIntent;\n        var storedInput, storedIntent;\n        try {\n            storedInput = window.sessionStorage.getItem('what-input');\n            storedIntent = window.sessionStorage.getItem('what-intent');\n        }\n        catch (e) {\n            console.warn('Failed to retrieve input status from session storage' + e);\n        }\n        _this.currentInput = storedInput || InputType.Initial;\n        _this.currentIntent = storedIntent || InputType.Initial;\n        _this.setInput = _this.setInput.bind(_this);\n        _this.setIntent = _this.setIntent.bind(_this);\n        _this.eventBuffer = _this.eventBuffer.bind(_this);\n        return _this;\n    }\n    InputProvider.prototype.getContainer = function (container) {\n        if (!container) {\n            return document.body;\n        }\n        if ('current' in container) {\n            if (container.current === null) {\n                console.warn('Your ref object can not be null, therefore, falling back to document.body');\n                return document.body;\n            }\n            else {\n                return container.current;\n            }\n        }\n        return container;\n    };\n    InputProvider.prototype.componentDidMount = function () {\n        elementClosestPolyfill(window);\n        this.supportsPassive = supportsPassive();\n        if (this.getContainer(this.props.container).closest('[data-whatinput]')) {\n            this.deferInputTracking = true;\n            return;\n        }\n        this.updateAttributes();\n        this.enableListeners(true);\n    };\n    InputProvider.prototype.updateAttributes = function () {\n        var intent = this.provideIntent ? this.currentIntent : null;\n        this.getContainer(this.props.container).setAttribute('data-whatinput', this.currentInput);\n        if (intent) {\n            this.getContainer(this.props.container).setAttribute('data-whatintent', intent);\n        }\n        try {\n            window.sessionStorage.setItem('what-input', this.currentInput);\n            window.sessionStorage.setItem('what-intent', this.currentIntent);\n        }\n        catch (e) {\n            console.warn('Failed to set input status in session storage' + e);\n        }\n    };\n    InputProvider.prototype.componentWillUnmount = function () {\n        if (this.deferInputTracking) {\n            return;\n        }\n        this.getContainer(this.props.container).removeAttribute('data-whatinput');\n        this.getContainer(this.props.container).removeAttribute('data-whatintent');\n        window.clearTimeout(this.eventTimer);\n        this.enableListeners(false);\n    };\n    InputProvider.prototype.enableListeners = function (enable) {\n        if (typeof window === 'undefined') {\n            return;\n        }\n        var options = this.supportsPassive\n            ? { passive: true }\n            : false;\n        var fn = enable ? window.addEventListener : window.removeEventListener;\n        if (window.PointerEvent) {\n            fn('pointerdown', this.setInput);\n        }\n        else {\n            fn('mousedown', this.setInput);\n            if ('ontouchstart' in window) {\n                fn('touchstart', this.eventBuffer, options);\n                fn('touchend', this.setInput);\n            }\n        }\n        if (this.provideIntent) {\n            if (window.PointerEvent) {\n                fn('pointermove', this.setIntent);\n            }\n            else {\n                fn('mousemove', this.setIntent);\n            }\n            fn(detectWheel(), this.setIntent, options);\n        }\n        fn('keydown', this.eventBuffer);\n        fn('keyup', this.eventBuffer);\n    };\n    InputProvider.prototype.setInput = function (event) {\n        if (this.isBuffering) {\n            return;\n        }\n        var eventKey = 'key' in event ? event.key : undefined;\n        var eventType = event.type;\n        var value = inputEventMap[eventType];\n        if (value === InputType.Pointer) {\n            value = getPointerType(event);\n        }\n        var ignoreMatch = eventKey ? ignoreKeys.indexOf(eventKey) === -1 : undefined;\n        var shouldUpdate = (value === InputType.Keyboard && eventKey && ignoreMatch) ||\n            value === InputType.Mouse ||\n            value === InputType.Touch;\n        if (this.currentInput !== value && shouldUpdate) {\n            this.currentInput = value;\n            this.updateAttributes();\n        }\n        if (this.currentIntent !== value && shouldUpdate && this.provideIntent) {\n            var activeElem = document.activeElement;\n            var notFormInput = activeElem &&\n                activeElem.nodeName &&\n                formInputs.indexOf(activeElem.nodeName.toLowerCase()) === -1;\n            if (notFormInput) {\n                this.currentIntent = value;\n                this.updateAttributes();\n            }\n        }\n    };\n    InputProvider.prototype.setIntent = function (event) {\n        this.detectScrolling(event);\n        if (!this.isBuffering && !this.isScrolling) {\n            var eventType = event.type;\n            var value = inputEventMap[eventType];\n            if (value === InputType.Pointer) {\n                value = getPointerType(event);\n            }\n            this.currentIntent = value;\n            this.updateAttributes();\n        }\n    };\n    InputProvider.prototype.eventBuffer = function (event) {\n        var _this = this;\n        this.setInput(event);\n        window.clearTimeout(this.eventTimer);\n        this.isBuffering = true;\n        this.eventTimer = window.setTimeout(function () {\n            _this.isBuffering = false;\n        }, 100);\n    };\n    InputProvider.prototype.detectScrolling = function (event) {\n        if (this.mousePosX !== event.screenX || this.mousePosY !== event.screenY) {\n            this.isScrolling = false;\n            this.mousePosX = event.screenX;\n            this.mousePosY = event.screenY;\n        }\n        else {\n            this.isScrolling = true;\n        }\n    };\n    InputProvider.prototype.render = function () {\n        return this.props.children || null;\n    };\n    return InputProvider;\n}(React.Component));\nexport { InputProvider };\nexport default InputProvider;\n"]},"metadata":{},"sourceType":"module"}